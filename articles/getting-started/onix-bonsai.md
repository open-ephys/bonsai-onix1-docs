---
uid: onix-bonsai
title: Configure Onix Hardware and Stream Data
---

## Construct Top-level Configuration Chain

Every workflow in Bonsai that is meant to work with ONIX hardware should contain a hardware
configuration chain in its first row which comprises of the following steps:
1) Creating a ONI context (an object that is capable of reading to and writing from ONIX hardware)
2) Writing properties to hardware
3) Starting acquisition

### Create a context

An ONI context contains information about the device driver and the hardware index which enables it
to communicate with the hardware. To create a context, place a <xref:OpenEphys.Onix1.CreateContext>
into the workflow. The context's device driver and index are set by editing the CreateContext's
properties. The Driver property is typically set to "riffa" which is the name of the PCIe device
used by ONIX, and the Index property is typically set to 0 though that can change if [multiple ONIX
systems](#multiple-onix-systems) are connected to your PC.

::: workflow
![/workflows/operators/CreateContext.bonsai workflow](../../workflows/operators/CreateContext.bonsai)
:::

The context generated by CreateContext when the workflow starts is a [data
element](xref:data-elements) named <xref:OpenEphys.Onix1.ContextTask>. 

### Configure hardware

Hardware configuration is performed when ContextTask passes through a [configuration
operator](xref:configure). A configuration operator allows the user to configure hardware by editing
its properties. There are two types of configuration operators: [device configuration
operators](xref:device-configure) and [device group configuration operators](xref:configure).
Device configuration operators allow configuration of a single device contained by a headstage,
miniscope, or breakout board whereas device group configuration operators allow configuration of all
devices contained by a headstage, miniscope, or breakout board. 
<!--We recommend using device group configuration operators for concision and
ease-of-use, though device operators can be helpful in more advanced workflows that require writing
to hardware while the workflow is running. 

Any number of configuration operators can be chained following a CreateContext operator. If you use
only device group configuration operators, you'll have between one and three total
configuration operators: one for the breakout board and one for each port that is connected to a
headstage or miniscope.  -->

::: workflow
![/workflows/getting-started/configure.bonsai workflow](../../workflows/getting-started/configure.bonsai)
:::

### Start acquisition

The data acquisition process is started when ContextTask passes through
<xref:OpenEphys.Onix1.StartAcquisition>. StartAcquisition allows the user to set parameters that are
related to data acquisition such as ReadSize and WriteSize. Setting the ReadSize property for a
particular workflow is a balancing act of minimizing latency of data data transfers from the ONIX
system and avoiding data accumulation in the ONIX system's hardware buffer.

<!-- TODO: Need a separate tutorial or guide on this -->

::: workflow
![/workflows/getting-started/start-acquisition.bonsai workflow](../../workflows/getting-started/start-acquisition.bonsai)
:::

## Acquire Data

Streaming data into Bonsai requires at least one [data I/O operator](xref:dataio).

### Set up data I/O operator(s)

Place a data I/O operator and set its DeviceName property for every device from which you would like
to stream. Setting the DeviceName property will tell the operator from which device to stream data.
This is referred to linking the data I/O operator to the device. Take this workflow for example:

::: workflow
![/images/analog-input.bonsai workflow](../../images/analog-input.bonsai)
:::

AnalogInput's DeviceName property is set to "BreakoutBoard/AnalogIO" so it will stream data from the
AnalogIO device on the breakout board. 

## Use Multiple Instances of Identical Hardware

### Multiple headstages/miniscopes

Linking the data I/O operator to devices when using two identical headstages or miniscopes involves
an additional step: renaming a configuration operator. Suppose you want to stream
orientation data from two Headstage64s through the Bno055Data operator. By default, the
ConfigureHeadstage64 operators are both named "Headstage64". This causes their devices to also have
identical names, "Headstage64/Bno055". The two headstages and their devices must be disambiguated. The
solution is to alias one or both headstages by editing their Name property.

::: workflow
![/images/bno055-data-alias.bonsai workflow](../../images/bno055-data-alias.bonsai)
:::

In this workflow, each ConfigureHeadstage64 operator previously named "Headstage64" has been
suffixed by the port to which the headstage is plugged. Now, the names "Headstage64A/Bno055" and
"Headstage64B/Bno055" are used to set the DeviceName property for each Bno055Data operator. 

### Multiple ONIX systems

If a second ONIX system is used on the same computer, a second configuration chain operator is
required. In this case, the Index property of the configuration chain that corresponds to the second
system should be set to 1.

::: workflow
![/workflows/getting-started/multiple-breakout.bonsai workflow](../../workflows/getting-started/multiple-breakout.bonsai)
:::

## Next Step

Now that you stream data into Bonsai from Onix hardware, the next step is visualize the data.