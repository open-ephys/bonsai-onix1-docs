---
uid: onix-configuration
title: Hardware Configuration
---

Because ONIX supports a variety of hardware, our workflow needs to be configured
to capture data from the specific headstages, miniscopes, etc. we are using with the
system. This page covers this process.

## Hardware Configuration Chain

Every workflow in Bonsai that is meant to work with ONIX hardware should contain a hardware
configuration chain in its first row which comprises of the following steps:

1) Creating a `ONI Context` for communicating ONIX hardware
2) Writing properties to hardware
3) Starting acquisition

### Create a context

An ONI context contains information about the device driver and the hardware
index which enables it to communicate with the hardware. To create a context,
place a <xref:OpenEphys.Onix1.CreateContext> into the workflow. The context's
device driver and index are set by editing the CreateContext's properties. The
Driver property is typically set to "riffa" which is the name of the PCIe device
used by ONIX, and the Index property is typically set to 0 though that can
change if [multiple ONIX systems](xref:onix-acquisition#multiple-onix-systems) are connected to your
PC.

::: workflow
![/workflows/operators/CreateContext.bonsai workflow](../../workflows/operators/CreateContext.bonsai)
:::

The context generated by CreateContext when the workflow starts is a [data
element](xref:data-elements) named <xref:OpenEphys.Onix1.ContextTask>.

### Configure hardware elements

Hardware configuration is performed when `ContextTask` passes through a [configuration
operator](xref:configure). A configuration operator allows the user to configure hardware by editing
its properties. There are two types of configuration operators: [device configuration
operators](xref:device-configure) and [device group configuration operators](xref:configure).
Device configuration operators allow configuration of a single device contained by a headstage,
miniscope, or breakout board whereas device group configuration operators allow configuration of all
devices contained by a headstage, miniscope, or breakout board.
<!--We recommend using device group configuration operators for concision and
ease-of-use, though device operators can be helpful in more advanced workflows that require writing
to hardware while the workflow is running.

Any number of configuration operators can be chained following a CreateContext operator. If you use
only device group configuration operators, you'll have between one and three total
configuration operators: one for the breakout board and one for each port that is connected to a
headstage or miniscope.  -->

::: workflow
![/workflows/getting-started/configure.bonsai workflow](../../workflows/getting-started/configure.bonsai)
:::

### Start acquisition

The data acquisition process is started when ContextTask passes through
<xref:OpenEphys.Onix1.StartAcquisition>. StartAcquisition allows the user to set parameters that are
related to data acquisition such as ReadSize and WriteSize. Setting the ReadSize property for a
particular workflow is a balancing act of minimizing latency of data data transfers from the ONIX
system and avoiding data accumulation in the ONIX system's hardware buffer.

<!-- TODO: Need a separate tutorial or guide on this -->

::: workflow
![/workflows/getting-started/start-acquisition.bonsai workflow](../../workflows/getting-started/start-acquisition.bonsai)
:::

At this point the workflow can be run to configure ONIX hardware. However,
after doing so, the workflow will immediately stop. This is because we are
missing the portion of our workflow to capture acquired data. We will explore 
this in the next section.