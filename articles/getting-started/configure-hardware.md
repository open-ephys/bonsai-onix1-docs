---
uid: configure-hardware
title: Configure Onix Hardware in Bonsai
---

Every workflow in Bonsai that is meant to work with ONIX hardware should contain a hardware
configuration chain in its first row. This hardware configuration chain comprises of the following
steps:
1) Creating a ONI context (an object that is capable of reading to and writing from ONIX hardware)
2) Writing properties to hardware
3) Starting acquisition

## Create a Context

An ONI context contains information about the device driver and index where the hardware which
enables it to read from and write to hardware. To create a context, place a
<xref:OpenEphys.Onix1.CreateContext> into the workflow. The context's device driver and index can be
set by the user by editing CreateContext's properties. The Driver property is typically set to
"riffa" which is the name of the PCIe device used by ONIX, and the Index property is typically set
to 0 (more on that in the multiple ONIX systems section).

::: workflow
![/workflows/operators/CreateContext.bonsai workflow](../../workflows/operators/CreateContext.bonsai)
:::

The context generated by CreateContext when the workflow starts is a [data
element](xref:data-elements) named <xref:OpenEphys.Onix1.ContextTask>. 

## Configure Hardware

Hardware configuration is performed when ContextTask passes through a [configuration
operator](xref:configure). A configuration operator allows the user to set the values that are
written to hardware by editing its properties. There are two types of configuration operators:
multi-device configuration operators and single-device configuration operators. Single-device
configuration operators allow configuration of a single device contained by a headstage, miniscope,
or breakout board whereas multi-device configuration operators allow configuration of all devices
contained by a headstage, miniscope, or breakout board. We recommend using multi-device
configuration operators for concision and ease-of-use, though single-device operators can be helpful
in more advanced workflows that require writing to hardware while the workflow is running. 

Any number of configuration operators can be chained following a CreateContext operator. If you use
only multi-device configuration operators, you'll probably have between one and three total
configuration operators: one for the breakout board and one for each port that is connected to a
headstage or miniscope. For example:

::: workflow
![/workflows/getting-started/configure.bonsai workflow](../../workflows/getting-started/configure.bonsai)
:::

## Start Acquisition

The data acquisition process is started when ContextTask passes through
<xref:OpenEphys.Onix1.StartAcquisition>. StartAcquisition allows the user to set parameters that are
related to data acquisition such as ReadSize and WriteSize. Setting the ReadSize property for a
particular workflow is a balancing act of minimizing latency of data from hardware to software while
not letting the ONIX system's hardware buffer accumulate data to maximum capacity.

<!-- Need a separate tutorial or guide on this -->

::: workflow
![/workflows/getting-started/start-acquisition.bonsai workflow](../../workflows/getting-started/start-acquisition.bonsai)
:::

## Configure Data I/O Operators

To finally acquire data from the configured hardware, place <xref:dataio> that correspond to the
devices from which you would like to stream on the workflow. The last step in the configuration
process is linking these data I/O operators to the previously devices configured. To do this, set
the DeviceName property of each data I/O operator in your workflow to a value that corresponds to
the device name in the configuration chain configuration operators. Take this workflow for example:

::: workflow
![/images/analog-input.bonsai workflow](../../images/analog-input.bonsai)
:::

The DeviceName property of the AnalogInput operator is set to "BreakoutBoard/AnalogIO". This links
the operator to the AnalogIO device on the Breakout Board meaning that the AnalogInput operator will
streams data from that device. 

## Configure Multiple Identical Headstages or Miniscopes

Linking the data I/O operator to devices when using two identical headstages or miniscopes involves
an additional step: aliasing the multi-device configuration operator. Suppose you want to stream
orientation data from two Headstage64s through the Bno055Data operator. By default, the
ConfigureHeadstage64 operators are both named "Headstage64". This causes their devices to also have
identical names, "Headstage64/Bno055". We need to disambiguate the headstages and their devices. The
solution is to alias one or both headstages. 

::: workflow
![/images/bno055-data-alias.bonsai workflow](../../images/bno055-data-alias.bonsai)
:::

In this workflow, each operator previously named "Headstage64" has been suffixed by the port to
which the headstage is plugged. Now you can use the names "Headstage64A/Bno055" and
"Headstage64B/Bno055" when setting the DeviceName property in each Bno055Data operator. 

<!-- ## Configuring & Acquiring from Multiple ONIX Systems

If a second system is used on the same computer, a second configuration chain operator is required.  -->